<div dir="rtl" align="center">

# **شبیه‌ساز الگوریتم تبادل کلیه TTCC**

**[English Version](./README.md)**

یک شبیه‌ساز مبتنی بر پایتون برای الگوریتم **«چرخه‌ها و زنجیره‌های معاملاتی برتر» (TTCC)** در تبادل کلیه، که بر اساس مقاله بنیادی راث، سونمز و اونور (۲۰۰۴) توسعه یافته است. این پروژه شامل یک بهبود نوآورانه است: یک سیاست انتخاب زنجیره جدید به نام **«بهترین ارزش» (قانون g)** که با هدف افزایش عدالت در تخصیص طراحی شده است.

</div>

---

### **📖 درباره پروژه**

نارسایی کلیوی مرحله نهایی یک بیماری کشنده است که پیوند کلیه بهترین روش درمان آن محسوب می‌شود. با این حال، کمبود شدید کلیه اهدایی یک معضل جهانی است و بسیاری از بیماران، حتی با داشتن اهداکننده زنده، به دلیل عدم سازگاری بیولوژیکی (مانند گروه خونی یا HLA) نمی‌توانند پیوند را انجام دهند.

**برنامه تبادل کلیه زوجی (KPD)** یک راه‌حل قدرتمند برای این مشکل است. در این برنامه، زوج‌های بیمار-اهداکننده ناسازگار می‌توانند اهداکنندگان خود را با یکدیگر مبادله کنند تا هر بیمار یک کلیه سازگار دریافت کند. **الگوریتم TTCC** یک مکانیزم پیشرفته است که این تبادلات را با شناسایی نه تنها مبادلات مستقیم (**چرخه‌ها**) بلکه **زنجیره‌های** پیچیده‌تری که ممکن است به اهدای عضو به لیست انتظار عمومی ختم شوند، مدیریت می‌کند.

این پروژه یک ابزار خط فرمان برای شبیه‌سازی کامل فرآیند TTCC، از افزودن زوج‌های بیمار-اهداکننده تا مصورسازی نتایج نهایی، فراهم می‌کند.

---

### **✨ ویژگی‌های کلیدی**

- **پیاده‌سازی کامل TTCC:** شبیه‌سازی دقیق منطق اصلی الگوریتم چرخه‌ها و زنجیره‌های معاملاتی برتر.
- **بررسی سازگاری واقع‌گرایانه:** مدل‌سازی سازگاری بر اساس **گروه خونی ABO** و **کراس‌مچ HLA** (با استفاده از آنتی‌بادی واکنشی پانل - PRA و آنتی‌ژن‌های غیرقابل‌قبول).
- **تولید ترجیحات پیشرفته:** محاسبه ترجیحات بیماران برای کلیه‌های موجود بر اساس یک تابع مطلوبیت که ریسک پس زدن پیوند را به حداقل می‌رساند (با در نظر گرفتن سن اهداکننده و عدم تطابق HLA).
- **قوانین انتخاب زنجیره متعدد:** پیاده‌سازی تمام سیاست‌های استاندارد انتخاب زنجیره (مانند بلندترین زنجیره، مبتنی بر اولویت) که در مقالات علمی توصیف شده‌اند.
- **💡 قانون ابتکاری «بهترین ارزش» (قانون g):** نوآوری اصلی این پروژه؛ یک سیاست مبتنی بر امتیاز که بین **کارایی** (تعداد پیوندها) و **عدالت** (اولویت‌دهی به بیماران سخت‌جور) تعادل برقرار می‌کند.
- **رابط کاربری تعاملی (CLI):** یک رابط منومحور و ساده برای مدیریت شبیه‌سازی.
- **مدیریت وضعیت:** قابلیت ذخیره و بارگذاری وضعیت استخر تبادل در یک فایل JSON.
- **مصورسازی گراف:** تولید گراف‌های شبکه تبادل در مراحل مختلف با استفاده از کتابخانه‌های NetworkX و Matplotlib.

---

### **🚀 شروع به کار**

برای اجرای شبیه‌ساز بر روی سیستم خود، مراحل زیر را دنبال کنید.

#### **پیش‌نیازها**

- پایتون نسخه ۳.۶ یا بالاتر
- مدیر بسته pip

#### **نصب و راه‌اندازی**

۱. **مخزن (Repository) را کلون کنید:**
    ```sh
    git clone https://github.com/YOUR_USERNAME/YOUR_REPOSITORY_NAME.git
    cd YOUR_REPOSITORY_NAME
    ```

۲. **بسته‌های مورد نیاز را نصب کنید:**
   این پروژه به `networkx` برای عملیات گراف و `matplotlib` برای مصورسازی نیاز دارد.
    ```sh
    pip install networkx matplotlib
    ```

#### **نحوه اجرا**

اسکریپت اصلی را از طریق ترمینال خود اجرا کنید:
```sh
python kidney.py
```
پس از اجرا، منوی اصلی برنامه نمایش داده می‌شود که از طریق آن می‌توانید زوج جدید اضافه کنید، ترجیحات را تولید کنید، الگوریتم را اجرا کنید و غیره.

---

### **⚙️ الگوریتم چگونه کار می‌کند؟**

شبیه‌سازی بر پایه دو مفهوم اصلی از الگوریتم TTCC بنا شده است:

- **چرخه‌ها (Cycles):** یک حلقه بسته از تبادلات که در آن گروهی از بیماران مستقیماً کلیه‌ها را بین خود مبادله می‌کنند. برای مثال: `بیمار۱ -> کلیه۲ -> بیمار۲ -> کلیه۱ -> بیمار۱`. چرخه‌ها خودکفا هستند و بالاترین اولویت را برای اجرا دارند.
- **زنجیره‌ها (w-Chains):** یک مسیر باز از تبادلات که با یک زوج بیمار-اهداکننده شروع شده و با اهدای یک کلیه به لیست انتظار عمومی (`w`) پایان می‌یابد. برای مثال: `بیمار۱ -> کلیه۲ -> بیمار۲ -> لیست انتظار`. زنجیره‌ها تنها زمانی بررسی می‌شوند که هیچ چرخه‌ای در سیستم وجود نداشته باشد.

#### **قوانین انتخاب زنجیره**

هنگامی که چندین زنجیره (w-chain) وجود دارد، باید یک سیاست برای انتخاب یکی از آن‌ها وجود داشته باشد. این شبیه‌ساز قوانین زیر را پیاده‌سازی کرده است:

- **`a` (کوتاه‌ترین، حذف):** کوتاه‌ترین زنجیره را انتخاب و نهایی می‌کند.
- **`b` (بلندترین، حذف):** بلندترین زنجیره را انتخاب و نهایی می‌کند (رویکرد حریصانه).
- **`c` (بلندترین، نگهداری):** بلندترین زنجیره را انتخاب می‌کند اما اعضای آن را فعال نگه می‌دارد تا شانس رشد زنجیره یا تبدیل آن به چرخه در آینده وجود داشته باشد.
- **`d` (اولویت، حذف):** اولین زنجیره‌ای که شامل بیمار با بالاترین اولویت است را انتخاب می‌کند.
- **`e` (اولویت، نگهداری):** مشابه قانون `d` است، اما اعضا را فعال نگه می‌دارد.
- **`f` (هیبریدی نوع O):** سیاستی که زنجیره‌هایی را که یک کلیه ارزشمند از نوع O به لیست انتظار اهدا می‌کنند، در اولویت حذف قرار می‌دهد.

#### **⭐ قانون g: بهترین ارزش (مبتنی بر امتیاز) - بهبود پیشنهادی ما**

این پروژه یک قانون ابتکاری برای ارائه نتایج عادلانه‌تر و جامع‌تر معرفی می‌کند. به جای تمرکز بر یک معیار واحد، این قانون به هر زنجیره بالقوه بر اساس ترکیبی از عوامل زیر یک امتیاز اختصاص می‌دهد:

- **۱۰+ امتیاز** به ازای هر بیمار در زنجیره (اولویت‌دهی به کارایی).
- **۵+ امتیاز** به ازای هر بیمار با گروه خونی O در زنجیره (برای جبران شانس کمتر این گروه خونی).
- **۱۰+ امتیاز** به ازای هر بیمار بسیار حساس‌شده (High PRA) (اولویت‌دهی به موارد سخت‌جور).

زنجیره‌ای که بالاترین امتیاز را کسب کند، انتخاب می‌شود. این رویکرد به الگوریتم اجازه می‌دهد تا تصمیمات ظریف‌تری بگیرد که بین تعداد کل پیوندها و نیازهای فوری گروه‌های خاصی از بیماران تعادل برقرار کند.

---

### **📂 ساختار پروژه**

```
.
├── kidney.py                # اسکریپت اصلی پایتون شامل تمام منطق برنامه
├── sample.json              # فایل داده نمونه شامل ۶۰ زوج بیمار-اهداکننده
├── graph_initial_state.png  # نمونه گراف خروجی
├── README.md                # این فایل (انگلیسی)
└── README_FA.md             # این فایل (فارسی)
```

---

### **🙏 قدردانی**

این پروژه یک پیاده‌سازی و توسعه از مفاهیم ارائه شده در مقاله بنیادی زیر است:
- Roth, A. E., Sönmez, T., & Ünver, M. U. (2004). Kidney exchange. *The Quarterly Journal of Economics*, 119(2), 457-488.

---

### **📜 مجوز (License)**

این پروژه تحت مجوز MIT منتشر شده است. برای جزئیات بیشتر به فایل `LICENSE` مراجعه کنید.
